<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GLM Tutorial: Link Function (Negative Binomial)</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f8f9fa;
      color: #333;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: linear-gradient(135deg, #d35400 0%, #e67e22 100%);
      color: white;
      padding: 20px;
      margin-bottom: 20px;
    }

    header h1 {
      font-size: 1.5em;
      margin-bottom: 5px;
    }

    header p {
      opacity: 0.9;
      font-size: 0.95em;
    }

    /* Progress bar */
    .progress-container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .progress-bar {
      display: flex;
      justify-content: space-between;
      position: relative;
      margin-bottom: 15px;
    }

    .progress-bar::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 3px;
      background: #e0e0e0;
      transform: translateY(-50%);
      z-index: 1;
    }

    .progress-fill {
      position: absolute;
      top: 50%;
      left: 0;
      height: 3px;
      background: #d35400;
      transform: translateY(-50%);
      z-index: 2;
      width: 20%;
    }

    .step-dot {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.85em;
      z-index: 3;
    }

    .step-dot.completed {
      background: #d35400;
      color: white;
    }

    .step-dot.current {
      background: #e67e22;
      color: white;
      transform: scale(1.2);
      box-shadow: 0 0 0 4px rgba(230, 126, 34, 0.3);
    }

    /* Context panel */
    .context-panel {
      background: #e8f8f5;
      border-left: 4px solid #1abc9c;
      padding: 15px 20px;
      border-radius: 0 8px 8px 0;
      margin-bottom: 20px;
    }

    .context-panel h4 {
      color: #117a65;
      margin-bottom: 8px;
    }

    .context-panel p {
      color: #117a65;
      font-size: 0.9em;
    }

    /* Instruction panel */
    .instruction-panel {
      background: #fef5e7;
      border-left: 4px solid #e67e22;
      padding: 15px 20px;
      border-radius: 0 8px 8px 0;
      margin-bottom: 20px;
    }

    .instruction-panel h3 {
      color: #d35400;
      margin-bottom: 8px;
    }

    /* Link options */
    .link-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .link-card {
      background: white;
      border: 3px solid #dee2e6;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .link-card:hover {
      border-color: #e67e22;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .link-card.selected {
      border-color: #27ae60;
      background: #eafaf1;
    }

    .link-card.wrong {
      border-color: #e74c3c;
      background: #fdedec;
      animation: shake 0.3s;
    }

    .link-card.semi-correct {
      border-color: #f39c12;
      background: #fef9e7;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .link-name {
      font-size: 1.3em;
      font-weight: 600;
      margin-bottom: 8px;
      color: #2c3e50;
    }

    .link-formula {
      font-family: 'Times New Roman', serif;
      font-size: 1.1em;
      background: #f8f9fa;
      padding: 8px 12px;
      border-radius: 4px;
      margin-bottom: 10px;
      display: inline-block;
    }

    .link-desc {
      color: #666;
      font-size: 0.9em;
    }

    /* Dialog box */
    .dialog-box {
      display: none;
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-top: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }

    .dialog-box.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .dialog-box.correct {
      border-left: 5px solid #27ae60;
    }

    .dialog-box.wrong {
      border-left: 5px solid #e74c3c;
    }

    .dialog-box.semi-correct {
      border-left: 5px solid #f39c12;
    }

    .dialog-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .dialog-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
    }

    .dialog-icon.correct { background: #d4edda; }
    .dialog-icon.wrong { background: #f8d7da; }
    .dialog-icon.semi-correct { background: #fff3cd; }

    .dialog-title {
      font-size: 1.2em;
      font-weight: 600;
    }

    .dialog-content {
      color: #555;
      line-height: 1.7;
    }

    .dialog-content ul {
      margin: 10px 0 10px 20px;
    }

    .dialog-content li {
      margin: 5px 0;
    }

    .highlight-box {
      background: #fef5e7;
      border-radius: 6px;
      padding: 12px 15px;
      margin-top: 15px;
      font-size: 0.9em;
    }

    /* Navigation */
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #dee2e6;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: #d35400;
      color: white;
      border: none;
    }

    .btn-primary:hover:not(:disabled) {
      background: #ba4a00;
    }

    .btn-primary:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #ecf0f1;
      color: #666;
      border: none;
    }

    .btn-secondary:hover {
      background: #bdc3c7;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Tutorial 4: Handling Overdispersion</h1>
      <p>Step 2: Choose the Link Function</p>
    </div>
  </header>

  <div class="container">
    <!-- Progress -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill"></div>
        <div class="step-dot completed">&#10003;</div>
        <div class="step-dot current">2</div>
        <div class="step-dot">3</div>
        <div class="step-dot">4</div>
        <div class="step-dot">5</div>
        <div class="step-dot">6</div>
      </div>
    </div>

    <!-- Context: Same link as Poisson -->
    <div class="context-panel">
      <h4>Same Link Function as Poisson</h4>
      <p>
        The link function choice is <strong>the same</strong> for Negative Binomial as for Poisson.
        Both model counts, so both need a link that ensures positive predictions.
        The key difference between the models is the <em>distribution</em>, not the link.
      </p>
    </div>

    <!-- Instruction -->
    <div class="instruction-panel">
      <h3>Step 2: Select the Link Function</h3>
      <p>Which function should map the linear predictor to expected counts?</p>
      <p style="font-size: 0.9em; color: #666;">
        <strong>Hint:</strong> We need g() such that g<sup>-1</sup>(X&beta;) is always positive.
      </p>
    </div>

    <!-- Link options -->
    <div class="link-options">
      <div class="link-card" data-link="log">
        <div class="link-name">Log Link</div>
        <div class="link-formula">g(&mu;) = ln(&mu;)</div>
        <p class="link-desc">Linear predictor maps to log of expected count. Ensures &mu; > 0.</p>
      </div>

      <div class="link-card" data-link="sqrt">
        <div class="link-name">Square Root Link</div>
        <div class="link-formula">g(&mu;) = &radic;&mu;</div>
        <p class="link-desc">Historically used for count data. Less interpretable coefficients.</p>
      </div>

      <div class="link-card" data-link="identity">
        <div class="link-name">Identity Link</div>
        <div class="link-formula">g(&mu;) = &mu;</div>
        <p class="link-desc">Direct mapping - linear predictor equals expected value.</p>
      </div>

      <div class="link-card" data-link="logit">
        <div class="link-name">Logit Link</div>
        <div class="link-formula">g(&mu;) = ln(&mu;/(1-&mu;))</div>
        <p class="link-desc">Maps to log-odds. Used for probabilities.</p>
      </div>
    </div>

    <!-- Dialog box -->
    <div class="dialog-box" id="dialogBox">
      <div class="dialog-header">
        <div class="dialog-icon" id="dialogIcon"></div>
        <div class="dialog-title" id="dialogTitle"></div>
      </div>
      <div class="dialog-content" id="dialogContent"></div>
    </div>

    <!-- Navigation -->
    <div class="nav-buttons">
      <a href="systematic.html" class="btn btn-secondary">&larr; Back to Systematic</a>
      <button class="btn btn-primary" id="continueBtn" disabled>Continue to Distribution &rarr;</button>
    </div>
  </div>

  <script>
    const dialogs = {
      log: {
        type: 'correct',
        icon: '&#10003;',
        title: 'Correct! Log link is the standard choice.',
        content: `
          <p>The <strong>log link</strong> is the canonical link for both Poisson and Negative Binomial regression:</p>
          <ul>
            <li><strong>Positive predictions:</strong> Since &mu; = exp(X&beta;), predictions are always > 0</li>
            <li><strong>Multiplicative interpretation:</strong> exp(&beta;) gives rate ratios</li>
            <li><strong>Natural for count processes:</strong> Counts often grow multiplicatively with predictors</li>
          </ul>
          <div class="highlight-box">
            <strong>Key insight:</strong> The link function is the same for Poisson and Negative Binomial.
            Both model counts, so both need the log link to ensure positive predictions.
            The difference is in the <em>variance function</em>, not the link.
          </div>
        `
      },
      sqrt: {
        type: 'semi-correct',
        icon: '~',
        title: 'Historically used, but not recommended today.',
        content: `
          <p>The <strong>square root link</strong> was sometimes used for count data:</p>
          <ul>
            <li><strong>Variance stabilising:</strong> For Poisson data, sqrt transform stabilises variance</li>
            <li><strong>Historical usage:</strong> Common before GLMs were well-understood</li>
            <li><strong>Less interpretable:</strong> Coefficients don't have a natural rate ratio interpretation</li>
          </ul>
          <div class="highlight-box">
            <strong>Modern practice:</strong> The log link is strongly preferred because exp(&beta;) gives
            interpretable rate ratios. Try selecting <strong>Log Link</strong> instead.
          </div>
        `
      },
      identity: {
        type: 'wrong',
        icon: '&#10007;',
        title: 'Not appropriate for count data!',
        content: `
          <p>The <strong>identity link</strong> is problematic for counts:</p>
          <ul>
            <li><strong>Negative predictions:</strong> If X&beta; < 0, we predict negative counts!</li>
            <li><strong>No natural lower bound:</strong> Counts must be &ge; 0, but &mu; = X&beta; can be anything</li>
            <li><strong>Works for Gaussian:</strong> Identity is appropriate when the response can be any real number</li>
          </ul>
          <div class="highlight-box">
            <strong>Example:</strong> With &beta;<sub>0</sub> = 100 and a large negative coefficient on temperature,
            cold days could predict -50 bike rentals. That's impossible!
            Try selecting <strong>Log Link</strong> instead.
          </div>
        `
      },
      logit: {
        type: 'wrong',
        icon: '&#10007;',
        title: 'Wrong data type - logit is for probabilities!',
        content: `
          <p>The <strong>logit link</strong> is designed for binary/proportion outcomes:</p>
          <ul>
            <li><strong>Bounded output:</strong> Logit<sup>-1</sup>(x) is always between 0 and 1</li>
            <li><strong>For probabilities:</strong> Perfect for Tutorial 2 (heart disease risk)</li>
            <li><strong>Not for counts:</strong> We need outputs > 1 (thousands of bike rentals!)</li>
          </ul>
          <div class="highlight-box">
            <strong>Data type mismatch:</strong> Logit constrains output to [0,1].
            Our bike rentals range from 22 to 8,714 - way outside this range!
            Try selecting <strong>Log Link</strong> instead.
          </div>
        `
      }
    };

    const cards = document.querySelectorAll('.link-card');
    const dialogBox = document.getElementById('dialogBox');
    const continueBtn = document.getElementById('continueBtn');

    cards.forEach(card => {
      card.addEventListener('click', () => {
        const link = card.dataset.link;
        const dialog = dialogs[link];

        // Reset all cards
        cards.forEach(c => c.classList.remove('selected', 'wrong', 'semi-correct'));

        // Style the clicked card
        if (dialog.type === 'correct') {
          card.classList.add('selected');
          continueBtn.disabled = false;
        } else if (dialog.type === 'semi-correct') {
          card.classList.add('semi-correct');
          continueBtn.disabled = true;
        } else {
          card.classList.add('wrong');
          continueBtn.disabled = true;
        }

        // Show dialog
        dialogBox.className = `dialog-box show ${dialog.type}`;
        document.getElementById('dialogIcon').className = `dialog-icon ${dialog.type}`;
        document.getElementById('dialogIcon').innerHTML = dialog.icon;
        document.getElementById('dialogTitle').textContent = dialog.title;
        document.getElementById('dialogContent').innerHTML = dialog.content;
      });
    });

    continueBtn.addEventListener('click', () => {
      window.location.href = 'distribution.html';
    });
  </script>
</body>
</html>
