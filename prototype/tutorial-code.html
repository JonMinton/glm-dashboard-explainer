<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GLM Tutorial: Implementation</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f8f9fa;
      color: #333;
      line-height: 1.6;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: #2c3e50;
      color: white;
      padding: 20px;
      margin-bottom: 20px;
    }

    header h1 {
      font-size: 1.5em;
      margin-bottom: 5px;
    }

    header p {
      opacity: 0.8;
      font-size: 0.95em;
    }

    /* Progress indicator */
    .progress-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .progress-step {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9em;
    }

    .progress-step .dot {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75em;
      font-weight: 600;
    }

    .progress-step.completed .dot {
      background: #27ae60;
      color: white;
    }

    .progress-step.current .dot {
      background: #3498db;
      color: white;
    }

    .progress-connector {
      flex: 1;
      height: 2px;
      background: #e0e0e0;
    }

    .progress-connector.completed {
      background: #27ae60;
    }

    /* Celebration banner */
    .celebration-banner {
      background: linear-gradient(135deg, #d4edda, #e8f4fd);
      border: 2px solid #27ae60;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }

    .celebration-banner h2 {
      color: #27ae60;
      font-size: 1.5em;
      margin-bottom: 8px;
    }

    .celebration-banner p {
      color: #666;
    }

    /* Model recap */
    .model-recap {
      background: #f0f7ff;
      border-left: 4px solid #3498db;
      padding: 15px 20px;
      border-radius: 0 8px 8px 0;
      margin-bottom: 20px;
    }

    .model-recap h3 {
      font-size: 0.9em;
      color: #2980b9;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .model-equation {
      font-family: 'Times New Roman', Georgia, serif;
      font-size: 1.2em;
      background: white;
      padding: 12px 20px;
      border-radius: 6px;
      display: inline-block;
      margin-bottom: 15px;
    }

    .model-specs {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .spec-item {
      background: white;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
    }

    .spec-item .label {
      font-size: 0.7em;
      color: #666;
      text-transform: uppercase;
    }

    .spec-item .value {
      font-size: 0.9em;
      font-weight: 600;
      color: #2c3e50;
      margin-top: 2px;
    }

    /* Language tabs */
    .language-tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 0;
    }

    .tab-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px 8px 0 0;
      background: #dee2e6;
      color: #666;
      cursor: pointer;
      font-weight: 600;
      font-size: 1em;
      transition: all 0.2s;
    }

    .tab-btn:hover {
      background: #e9ecef;
    }

    .tab-btn.active {
      background: white;
      color: #2980b9;
      border: 1px solid #dee2e6;
      border-bottom: 1px solid white;
      margin-bottom: -1px;
    }

    /* Code panel */
    .code-panel {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 0 8px 8px 8px;
      padding: 20px;
      margin-bottom: 20px;
      display: none;
    }

    .code-panel.active {
      display: block;
    }

    .code-section {
      margin-bottom: 20px;
    }

    .code-section:last-child {
      margin-bottom: 0;
    }

    .code-section h4 {
      color: #2980b9;
      font-size: 0.95em;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .code-section h4 .step-num {
      background: #3498db;
      color: white;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8em;
    }

    pre {
      background: #2c3e50;
      border-radius: 6px;
      padding: 15px;
      overflow-x: auto;
      font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
      font-size: 0.85em;
      line-height: 1.5;
      color: #ecf0f1;
    }

    code {
      font-family: inherit;
    }

    /* Syntax highlighting */
    .comment { color: #7f8c8d; }
    .keyword { color: #e74c3c; }
    .string { color: #2ecc71; }
    .function { color: #9b59b6; }
    .variable { color: #f39c12; }
    .number { color: #3498db; }
    .operator { color: #e74c3c; }

    .code-note {
      background: #e8f4fd;
      border-left: 3px solid #3498db;
      padding: 10px 15px;
      border-radius: 0 6px 6px 0;
      margin-top: 10px;
      font-size: 0.9em;
      color: #666;
    }

    .output-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #dee2e6;
    }

    .output-section h4 {
      color: #27ae60;
      margin-bottom: 10px;
    }

    .output-example {
      background: #2c3e50;
      border-radius: 6px;
      padding: 15px;
      font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
      font-size: 0.8em;
      line-height: 1.5;
      white-space: pre-wrap;
      color: #ecf0f1;
      overflow-x: auto;
    }

    /* Next steps */
    .next-steps {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .next-steps h3 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 1.1em;
    }

    .next-steps ul {
      list-style: none;
      padding: 0;
    }

    .next-steps li {
      padding: 8px 0;
      padding-left: 25px;
      position: relative;
      color: #666;
      border-bottom: 1px solid #f0f0f0;
    }

    .next-steps li:last-child {
      border-bottom: none;
    }

    .next-steps li::before {
      content: '‚Üí';
      position: absolute;
      left: 0;
      color: #3498db;
      font-weight: bold;
    }

    /* Navigation */
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid #dee2e6;
    }

    .btn {
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-block;
      border: none;
      font-size: 1em;
    }

    .btn-primary {
      background: #27ae60;
      color: white;
    }

    .btn-primary:hover {
      background: #219a52;
    }

    .btn-secondary {
      background: #ecf0f1;
      color: #666;
    }

    .btn-secondary:hover {
      background: #bdc3c7;
    }

    @media (max-width: 768px) {
      .model-specs {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Tutorial: Implementation</h1>
      <p>See your model in R and Python code</p>
    </div>
  </header>

  <div class="container">
    <!-- Progress -->
    <div class="progress-indicator">
      <div class="progress-step completed">
        <span class="dot">&#10003;</span>
        <span>Systematic</span>
      </div>
      <div class="progress-connector completed"></div>
      <div class="progress-step completed">
        <span class="dot">&#10003;</span>
        <span>Link</span>
      </div>
      <div class="progress-connector completed"></div>
      <div class="progress-step completed">
        <span class="dot">&#10003;</span>
        <span>Distribution</span>
      </div>
      <div class="progress-connector completed"></div>
      <div class="progress-step completed">
        <span class="dot">&#10003;</span>
        <span>Fitting</span>
      </div>
      <div class="progress-connector completed"></div>
      <div class="progress-step current">
        <span class="dot">5</span>
        <span>Implementation</span>
      </div>
    </div>

    <!-- Celebration -->
    <div class="celebration-banner">
      <h2>üéâ Tutorial Complete!</h2>
      <p>You've successfully specified a complete GLM. Here's how to fit it in practice.</p>
    </div>

    <!-- Model Recap -->
    <div class="model-recap">
      <h3>Your Complete Model</h3>
      <div class="model-equation">
        MaxHeartRate ~ Normal(Œº, œÉ¬≤) where Œº = Œ≤‚ÇÄ + Œ≤‚ÇÅ¬∑Age + Œ≤‚ÇÇ¬∑RestBP
      </div>
      <div class="model-specs">
        <div class="spec-item">
          <div class="label">Response</div>
          <div class="value">Max Heart Rate</div>
        </div>
        <div class="spec-item">
          <div class="label">Link</div>
          <div class="value">Identity</div>
        </div>
        <div class="spec-item">
          <div class="label">Family</div>
          <div class="value">Gaussian</div>
        </div>
        <div class="spec-item">
          <div class="label">Method</div>
          <div class="value">Maximum Likelihood</div>
        </div>
      </div>
    </div>

    <!-- Language Tabs -->
    <div class="language-tabs">
      <button class="tab-btn active" onclick="showTab('r')">R</button>
      <button class="tab-btn" onclick="showTab('python')">Python</button>
    </div>

    <!-- R Code Panel -->
    <div class="code-panel active" id="r-panel">
      <div class="code-section">
        <h4><span class="step-num">1</span> Load the data</h4>
        <pre><code><span class="comment"># Load the heart disease dataset</span>
<span class="variable">heart</span> <span class="operator">&lt;-</span> <span class="function">read.csv</span>(<span class="string">"heart.csv"</span>)

<span class="comment"># Preview the data</span>
<span class="function">head</span>(<span class="variable">heart</span>)</code></pre>
      </div>

      <div class="code-section">
        <h4><span class="step-num">2</span> Fit the GLM</h4>
        <pre><code><span class="comment"># Fit the model using glm()</span>
<span class="variable">model</span> <span class="operator">&lt;-</span> <span class="function">glm</span>(
  <span class="variable">thalach</span> <span class="operator">~</span> <span class="variable">age</span> <span class="operator">+</span> <span class="variable">trestbps</span>,
  <span class="keyword">data</span> <span class="operator">=</span> <span class="variable">heart</span>,
  <span class="keyword">family</span> <span class="operator">=</span> <span class="function">gaussian</span>(<span class="keyword">link</span> <span class="operator">=</span> <span class="string">"identity"</span>)
)</code></pre>
        <div class="code-note">
          <strong>Note:</strong> For Gaussian + identity, you could also use <code>lm()</code> which gives identical results.
          Using <code>glm()</code> makes the GLM framework explicit and is easily adapted to other families.
        </div>
      </div>

      <div class="code-section">
        <h4><span class="step-num">3</span> View results</h4>
        <pre><code><span class="comment"># Summary of fitted model</span>
<span class="function">summary</span>(<span class="variable">model</span>)

<span class="comment"># Extract coefficients</span>
<span class="function">coef</span>(<span class="variable">model</span>)

<span class="comment"># Confidence intervals</span>
<span class="function">confint</span>(<span class="variable">model</span>)</code></pre>
      </div>

      <div class="code-section">
        <h4><span class="step-num">4</span> Check assumptions</h4>
        <pre><code><span class="comment"># Diagnostic plots</span>
<span class="function">par</span>(<span class="keyword">mfrow</span> <span class="operator">=</span> <span class="function">c</span>(<span class="number">2</span>, <span class="number">2</span>))
<span class="function">plot</span>(<span class="variable">model</span>)

<span class="comment"># Check for patterns in residuals</span>
<span class="comment"># - Residuals vs Fitted: look for constant spread</span>
<span class="comment"># - Q-Q plot: points should follow diagonal</span>
<span class="comment"># - Scale-Location: horizontal band = good</span>
<span class="comment"># - Residuals vs Leverage: no influential outliers</span></code></pre>
      </div>

      <div class="output-section">
        <h4>Expected Output</h4>
        <div class="output-example">Call:
glm(formula = thalach ~ age + trestbps, family = gaussian(link = "identity"),
    data = heart)

Coefficients:
             Estimate Std. Error t value Pr(>|t|)
(Intercept) 198.45632    8.24156  24.080  < 2e-16 ***
age          -0.94186    0.08012 -11.756  < 2e-16 ***
trestbps     -0.09543    0.04892  -1.951   0.0519 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for gaussian family taken to be 520.7234)

    Null deviance: 227457  on 302  degrees of freedom
Residual deviance: 156217  on 300  degrees of freedom
AIC: 2815.4</div>
      </div>
    </div>

    <!-- Python Code Panel -->
    <div class="code-panel" id="python-panel">
      <div class="code-section">
        <h4><span class="step-num">1</span> Import libraries and load data</h4>
        <pre><code><span class="keyword">import</span> pandas <span class="keyword">as</span> pd
<span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm
<span class="keyword">import</span> statsmodels.formula.api <span class="keyword">as</span> smf

<span class="comment"># Load the heart disease dataset</span>
<span class="variable">heart</span> <span class="operator">=</span> pd.<span class="function">read_csv</span>(<span class="string">"heart.csv"</span>)

<span class="comment"># Preview the data</span>
<span class="function">print</span>(<span class="variable">heart</span>.<span class="function">head</span>())</code></pre>
      </div>

      <div class="code-section">
        <h4><span class="step-num">2</span> Fit the GLM</h4>
        <pre><code><span class="comment"># Fit the model using formula interface</span>
<span class="variable">model</span> <span class="operator">=</span> smf.<span class="function">glm</span>(
    <span class="keyword">formula</span><span class="operator">=</span><span class="string">"thalach ~ age + trestbps"</span>,
    <span class="keyword">data</span><span class="operator">=</span><span class="variable">heart</span>,
    <span class="keyword">family</span><span class="operator">=</span>sm.families.<span class="function">Gaussian</span>(
        <span class="keyword">link</span><span class="operator">=</span>sm.families.links.<span class="function">Identity</span>()
    )
).<span class="function">fit</span>()</code></pre>
        <div class="code-note">
          <strong>Note:</strong> For Gaussian + identity, you could also use <code>smf.ols()</code> which gives identical results.
          Using <code>glm()</code> makes the GLM framework explicit and is easily adapted to other families.
        </div>
      </div>

      <div class="code-section">
        <h4><span class="step-num">3</span> View results</h4>
        <pre><code><span class="comment"># Summary of fitted model</span>
<span class="function">print</span>(<span class="variable">model</span>.<span class="function">summary</span>())

<span class="comment"># Extract coefficients</span>
<span class="function">print</span>(<span class="variable">model</span>.<span class="variable">params</span>)

<span class="comment"># Confidence intervals</span>
<span class="function">print</span>(<span class="variable">model</span>.<span class="function">conf_int</span>())</code></pre>
      </div>

      <div class="code-section">
        <h4><span class="step-num">4</span> Check assumptions</h4>
        <pre><code><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt
<span class="keyword">import</span> scipy.stats <span class="keyword">as</span> stats

<span class="comment"># Get residuals and fitted values</span>
<span class="variable">residuals</span> <span class="operator">=</span> <span class="variable">model</span>.<span class="variable">resid_pearson</span>
<span class="variable">fitted</span> <span class="operator">=</span> <span class="variable">model</span>.<span class="variable">fittedvalues</span>

<span class="comment"># Create diagnostic plots</span>
<span class="variable">fig</span>, <span class="variable">axes</span> <span class="operator">=</span> plt.<span class="function">subplots</span>(<span class="number">2</span>, <span class="number">2</span>, <span class="keyword">figsize</span><span class="operator">=</span>(<span class="number">10</span>, <span class="number">8</span>))

<span class="comment"># Residuals vs Fitted</span>
<span class="variable">axes</span>[<span class="number">0</span>, <span class="number">0</span>].<span class="function">scatter</span>(<span class="variable">fitted</span>, <span class="variable">residuals</span>, <span class="keyword">alpha</span><span class="operator">=</span><span class="number">0.5</span>)
<span class="variable">axes</span>[<span class="number">0</span>, <span class="number">0</span>].<span class="function">axhline</span>(<span class="keyword">y</span><span class="operator">=</span><span class="number">0</span>, <span class="keyword">color</span><span class="operator">=</span><span class="string">'red'</span>, <span class="keyword">linestyle</span><span class="operator">=</span><span class="string">'--'</span>)
<span class="variable">axes</span>[<span class="number">0</span>, <span class="number">0</span>].<span class="function">set_xlabel</span>(<span class="string">'Fitted values'</span>)
<span class="variable">axes</span>[<span class="number">0</span>, <span class="number">0</span>].<span class="function">set_ylabel</span>(<span class="string">'Residuals'</span>)
<span class="variable">axes</span>[<span class="number">0</span>, <span class="number">0</span>].<span class="function">set_title</span>(<span class="string">'Residuals vs Fitted'</span>)

<span class="comment"># Q-Q plot</span>
stats.<span class="function">probplot</span>(<span class="variable">residuals</span>, <span class="keyword">plot</span><span class="operator">=</span><span class="variable">axes</span>[<span class="number">0</span>, <span class="number">1</span>])
<span class="variable">axes</span>[<span class="number">0</span>, <span class="number">1</span>].<span class="function">set_title</span>(<span class="string">'Q-Q Plot'</span>)

plt.<span class="function">tight_layout</span>()
plt.<span class="function">show</span>()</code></pre>
      </div>

      <div class="output-section">
        <h4>Expected Output</h4>
        <div class="output-example">                 Generalized Linear Model Regression Results
==============================================================================
Dep. Variable:                thalach   No. Observations:                  303
Model:                            GLM   Df Residuals:                      300
Model Family:                Gaussian   Df Model:                            2
Link Function:               Identity   Scale:                          520.72
Method:                          IRLS   Log-Likelihood:                -1403.7
Date:                Wed, 11 Dec 2024   Deviance:                   1.5622e+05
Time:                        10:30:00   Pearson chi2:                 1.56e+05
No. Iterations:                     3   Pseudo R-squ. (CS):             0.2780
Covariance Type:            nonrobust
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept    198.4563      8.242     24.080      0.000     182.303     214.610
age           -0.9419      0.080    -11.756      0.000      -1.099      -0.785
trestbps      -0.0954      0.049     -1.951      0.051      -0.191       0.001
==============================================================================</div>
      </div>
    </div>

    <!-- Next Steps -->
    <div class="next-steps">
      <h3>What's Next?</h3>
      <ul>
        <li><strong>Interpret the coefficients</strong> ‚Äî Age has a negative effect (~1 bpm decrease per year)</li>
        <li><strong>Check model diagnostics</strong> ‚Äî Examine residual plots for assumption violations</li>
        <li><strong>Consider other predictors</strong> ‚Äî Would adding more variables improve the model?</li>
        <li><strong>Try other GLM families</strong> ‚Äî What if the response was binary (disease present/absent)?</li>
        <li><strong>Compare models</strong> ‚Äî Use AIC to compare models with different predictors</li>
      </ul>
    </div>

    <!-- Navigation -->
    <div class="nav-buttons">
      <a href="tutorial-fitting.html" class="btn btn-secondary">&larr; Back to Fitting</a>
      <a href="tutorial.html" class="btn btn-primary">Start Over ‚Üª</a>
    </div>
  </div>

  <script>
    function showTab(language) {
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      // Update code panels
      document.querySelectorAll('.code-panel').forEach(panel => {
        panel.classList.remove('active');
      });
      document.getElementById(`${language}-panel`).classList.add('active');
    }
  </script>
</body>
</html>
